{% comment %}
  Best Sellers section for skincare storefront
{% endcomment %}

{{ 'section-best-sellers.css' | asset_url | stylesheet_tag }}

<section id="shopify-section-{{ section.id }}" class="shopify-section section best-sellers color-{{ section.settings.color_scheme }} gradient">
  <div class="page-width">
    <header class="best-sellers__header">
      {% if section.settings.heading != blank %}
        <h2 class="best-sellers__title h2">{{ section.settings.heading }}</h2>
      {% endif %}
      {% if section.settings.description != blank %}
        <p class="best-sellers__description text-body">{{ section.settings.description }}</p>
      {% endif %}
    </header>

    {% assign collection = collections[section.settings.collection] %}
    {% if collection and collection.products_count > 0 %}
      <div class="best-sellers__products">
        <div class="best-sellers__slider">
          <div class="best-sellers__slider-container" tabindex="-1">
            {% for product in collection.products limit: section.settings.products_to_show %}
              <article class="best-sellers__product contains-card--product" aria-labelledby="product-title-{{ product.id }}">
                <a href="{{ product.url }}" class="best-sellers__product-image">
                  {% if product.featured_image %}
                    <img src="{{ product.featured_image | image_url: width: 600 }}" alt="{{ product.featured_image.alt | escape }}" loading="lazy" />
                  {% endif %}
                </a>
                <div class="best-sellers__product-info">
                  <h3 id="product-title-{{ product.id }}" class="best-sellers__product-title h5">
                    <a href="{{ product.url }}">{{ product.title }}</a>
                  </h3>

                  <div class="best-sellers__product-rating">
                    <div class="best-sellers__stars">
                      <span class="best-sellers__star">★</span>
                      <span class="best-sellers__star">★</span>
                      <span class="best-sellers__star">★</span>
                      <span class="best-sellers__star">★</span>
                      <span class="best-sellers__star best-sellers__star--empty">☆</span>
                    </div>
                    <span class="best-sellers__rating-count">({{ product.metafields.reviews.rating_count | default: 0 }})</span>
                  </div>

                  <div class="best-sellers__product-price">
                    {% render 'price', product: product, use_variant: true, show_badges: false %}
                  </div>
                </div>
                {% assign first_available_variant = product.variants | where: 'available', true | first %}
                  {% if first_available_variant %}
                    <form class="best-sellers__add-form" action="/cart/add" method="post" enctype="multipart/form-data">
                      <input type="hidden" name="id" value="{{ first_available_variant.id }}">
                      <button type="submit" class="best-sellers__add-to-cart button button--primary">
                        {{ 'products.product.add_to_cart' | t }}
                      </button>
                    </form>
                  {% else %}
                    <button class="best-sellers__add-to-cart button" disabled>
                      {{ 'products.product.sold_out' | t }}
                    </button>
                  {% endif %}
              </article>
            {% endfor %}
          </div>
        </div>
      </div>
    {% endif %}
  </div>

  <style>
    #shopify-section-{{ section.id }} { padding-top: {{ section.settings.padding_top | default: 0 }}px; padding-bottom: {{ section.settings.padding_bottom | default: 0 }}px; }
  </style>
</section>

{% schema %}
{
  "name": "Best Sellers",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Products" },
    { "type": "textarea", "id": "description", "label": "Description", "default": "Discover our most-loved skincare essentials" },
    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "range", "id": "products_to_show", "label": "Products to show", "min": 2, "max": 12, "step": 1, "default": 8 },
    { "type": "checkbox", "id": "show_view_all", "label": "Show view all button", "default": true },
    { "type": "text", "id": "view_all_text", "label": "View all text", "default": "View All Products" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 120, "step": 4, "unit": "px", "label": "Padding top", "default": 80 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 120, "step": 4, "unit": "px", "label": "Padding bottom", "default": 80 }
  ],
  "presets": [
    { "name": "Best Sellers" }
  ]
}
{% endschema %}
